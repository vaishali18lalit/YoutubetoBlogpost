<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Blog and Quiz Generator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .loading-spinner {
            display: none;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .markdown-content h1 { font-size: 1.8rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 1rem; }
        .markdown-content h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .markdown-content h3 { font-size: 1.5rem; font-weight: bold; margin-top: 1rem; margin-bottom: 0.6rem; }
        .markdown-content p { margin-bottom: 1rem; }
        .markdown-content ul, .markdown-content ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .markdown-content li { margin-bottom: 0.5rem; }
        .markdown-content img { max-width: 100%; height: auto; margin: 1rem 0; }
        .markdown-content blockquote { border-left: 4px solid #e2e8f0; padding-left: 1rem; margin: 1rem 0; font-style: italic; }
        .markdown-content code { background-color: #f1f5f9; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; }
        .markdown-content pre { background-color: #f1f5f9; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 1rem 0; }
        .markdown-content {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .markdown-content p {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .markdown-content pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700 mb-2">YouTube Blog and Quiz Generator</h1>
            <p class="text-gray-600">Transform YouTube videos into professional blog posts or interactive quizzes</p>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <form id="youtube-form" class="flex flex-col md:flex-row items-stretch gap-4">
                {% csrf_token %}
                <div class="flex-grow">
                    <label for="video_url" class="block text-sm font-medium text-gray-700 mb-2">Enter YouTube Video URL:</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fab fa-youtube text-red-500"></i>
                        </div>
                        <input type="url" id="video_url" name="video_url" 
                            class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="https://www.youtube.com/watch?v=..." required>
                    </div>
                </div>
                <div class="md:self-end">
                    <button type="submit" id="submit-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out flex items-center justify-center min-w-[160px]">
                        <span>Analyze Video</span>
                        <i class="fas fa-spinner loading-spinner ml-2"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- Video Preview Section (Hidden initially) -->
        <div id="video-preview" class="bg-white rounded-lg shadow-md p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Video Preview</h2>
            <div class="aspect-w-16 aspect-h-9 mb-4">
                <div id="video-embed" class="w-full h-0 pb-[56.25%] relative">
                    <!-- Video will be embedded here -->
                </div>
            </div>
            <div id="video-details" class="mb-4">
                <h3 id="video-title" class="text-lg font-medium text-gray-800"></h3>
                <p id="video-channel" class="text-sm text-gray-600"></p>
            </div>
        </div>

        <!-- Options Section (Hidden initially) -->
        <div id="options-section" class="mb-8 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">What would you like to generate?</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Blog Post Option -->
                <div class="option-card bg-white rounded-lg shadow-md p-6 border-2 border-transparent hover:border-indigo-500 cursor-pointer transition-all duration-300" data-option="blog">
                    <div class="flex justify-center mb-4">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-blog text-2xl text-indigo-600"></i>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-center mb-2">Blog Post</h3>
                    <p class="text-gray-600 text-center">Generate a professional blog post based on the video content</p>
                </div>
                
                <!-- Quiz Option -->
                <div class="option-card bg-white rounded-lg shadow-md p-6 border-2 border-transparent hover:border-indigo-500 cursor-pointer transition-all duration-300" data-option="quiz">
                    <div class="flex justify-center mb-4">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-question-circle text-2xl text-indigo-600"></i>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-center mb-2">Quiz</h3>
                    <p class="text-gray-600 text-center">Create interactive quiz questions based on the video content</p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-container" class="hidden">
            <!-- Tabs -->
            <div class="bg-white rounded-lg shadow-md mb-8">
                <div class="border-b border-gray-200">
                    <nav class="flex -mb-px">
                        <button id="tab-blog" class="tab-btn w-1/2 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none">
                            <i class="fas fa-blog mr-2"></i>Blog Post
                        </button>
                        <button id="tab-quiz" class="tab-btn w-1/2 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none">
                            <i class="fas fa-question-circle mr-2"></i>Quiz
                        </button>
                    </nav>
                </div>
                
                <!-- Content Containers -->
                <div class="p-6">
                    <!-- Blog Post Content -->
                    <div id="blog-content" class="tab-content">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Generated Blog Post</h2>
                            <button id="copy-blog" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-1 px-3 rounded-md text-sm flex items-center">
                                <i class="far fa-copy mr-1"></i> Copy
                            </button>
                        </div>
                        <div id="blog-post" class="markdown-content prose max-w-none"></div>
                    </div>
                    
                    <!-- Quiz Content -->
                    <div id="quiz-content" class="tab-content">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Generated Quiz Questions</h2>
                            <button id="copy-quiz" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-1 px-3 rounded-md text-sm flex items-center">
                                <i class="far fa-copy mr-1"></i> Copy
                            </button>
                            <!-- Button to reveal answers
                            <button id="reveal-answers" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-1 px-3 rounded-md text-sm">
                                Reveal Answers
                            </button> -->
                        </div>
                        <div id="quiz-questions"></div>
                        <div id="quiz-answers" class="hidden">
                            <!-- This is where the answers will go -->
                            <div class="mt-4">
                                <h3 class="text-lg font-semibold text-gray-700">Answers:</h3>
                                <ul class="list-disc ml-5">
                                    <!-- Sample answers, these should be dynamically generated -->
                                    <li>Answer for Question 1</li>
                                    <li>Answer for Question 2</li>
                                    <li>Answer for Question 3</li>
                                </ul>
                            </div>
                        </div>
                    </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="hidden">
            <div class="flex flex-col items-center justify-center py-12">
                <div class="w-16 h-16 border-4 border-indigo-200 border-t-4 border-t-indigo-600 rounded-full animate-spin mb-4"></div>
                <p id="loading-message" class="text-gray-600 text-center">Analyzing YouTube video content...</p>
            </div>
        </div>

        <!-- Error Display -->
        <div id="error-display" class="hidden bg-red-50 border-l-4 border-red-500 p-4 mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-500"></i>
                </div>
                <div class="ml-3">
                    <p id="error-message" class="text-sm text-red-700">An error occurred.</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 YouTube Blog and Quiz Generator</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const form = document.getElementById('youtube-form');
            const videoUrlInput = document.getElementById('video_url');
            const submitBtn = document.getElementById('submit-btn');
            const loadingSpinner = document.querySelector('.loading-spinner');
            const videoPreview = document.getElementById('video-preview');
            const videoEmbed = document.getElementById('video-embed');
            const videoTitle = document.getElementById('video-title');
            const videoChannel = document.getElementById('video-channel');
            const optionsSection = document.getElementById('options-section');
            const optionCards = document.querySelectorAll('.option-card');
            const resultsContainer = document.getElementById('results-container');
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const loadingState = document.getElementById('loading-state');
            const loadingMessage = document.getElementById('loading-message');
            const errorDisplay = document.getElementById('error-display');
            const errorMessage = document.getElementById('error-message');
            const blogPost = document.getElementById('blog-post');
            const quizQuestions = document.getElementById('quiz-questions');
            const copyBlogBtn = document.getElementById('copy-blog');
            const copyQuizBtn = document.getElementById('copy-quiz');
            
            // CSRF Token
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
            
            // Parse YouTube video ID from URL
            function getYouTubeVideoId(url) {
                const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[7].length === 11) ? match[7] : null;
            }
            
            // Show error message
            function showError(message) {
                errorMessage.textContent = message || 'An error occurred. Please try again.';
                errorDisplay.classList.remove('hidden');
                loadingState.classList.add('hidden');
                submitBtn.disabled = false;
                loadingSpinner.style.display = 'none';
                
                // Scroll to error
                errorDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // Hide error message
            function hideError() {
                errorDisplay.classList.add('hidden');
            }
            
            function renderMarkdown(markdown) {
                const imageRegex = /!\[(.*?)\]\((.*?)\)/g;
                let html = markdown.replace(imageRegex, (match, altText, imagePath) => {
                    if (imagePath.startsWith('data:image/') || imagePath.startsWith('http')) {
                        return `<img src="${imagePath}" alt="${altText}" class="my-4 rounded-lg shadow">`;
                    } else {
                        const fileName = imagePath.split('/').pop().replace(/['"]/g, '');
                        return `<img src="/media/${fileName}" alt="${altText}" class="my-4 rounded-lg shadow">`;
                    }
                });

                html = html
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" class="text-indigo-600 hover:underline">$1</a>')
                    .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                    .replace(/\n/g, '<br>');

                return `<div class="markdown-container">${html}</div>`;
            }

            
            // Copy text to clipboard
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    // Success message could be added here
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                });
            }
            
            // Function to format quiz questions with "Show Answer" button
            function formatQuizQuestions(quizText) {
                const questions = quizText.split(/\d+\.\s/).filter(q => q.trim().length > 0);
                let html = '<div class="space-y-6">';

                questions.forEach((question, index) => {
                    const parts = question.split(/(?:[A-D]\)|\n[A-D]:)\s/);
                    if (parts.length > 1) {
                        const questionText = parts[0].trim();
                        const options = parts.slice(1, 5);
                        const answerLine = question.match(/Answer:\s*([A-D])/);
                        const correctAnswer = answerLine ? answerLine[1] : '';

                        html += `
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <p class="font-semibold mb-2">${index + 1}. ${questionText}</p>
                                <div class="ml-4 space-y-2">`;
                        ['A', 'B', 'C', 'D'].forEach((letter, i) => {
                                const option = options[i] ? options[i].split('Answer:')[0].trim() : '';
                                // No conditional styling for options, all will have the same style
                                html += `
                                    <div class="flex items-start">
                                        <span class="inline-flex items-center justify-center h-5 w-5 rounded-full bg-gray-200 text-gray-700 font-medium text-xs mr-2 mt-0.5">${letter}</span>
                                        <span>${option}</span>
                                    </div>`;
                            });

                        html += `
                                </div>
                                <div class="mt-3 pt-2 border-t border-gray-200">
                                    <button class="toggle-answer text-blue-600 font-medium hover:underline mt-2">Show Answer</button>
                                    <p class="answer-text text-sm font-medium text-green-600 mt-2 hidden">Correct Answer: ${correctAnswer}</p>
                                </div>
                            </div>`;
                    }
                });

                html += '</div>';
                return html;
            }

// Event listener for answer toggling

            // Show video preview
            function showVideoPreview(videoId) {
                // Create embed code
                videoEmbed.innerHTML = `<iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                
                // You could add API calls to get video metadata here
                // For now, we'll just show the preview
                videoPreview.classList.remove('hidden');
                
                // Scroll to the preview
                videoPreview.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Show options
                setTimeout(() => {
                    optionsSection.classList.remove('hidden');
                }, 500);
            }
            
            // Handle form submission
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Reset UI
                hideError();
                resultsContainer.classList.add('hidden');
                
                // Get video URL
                const videoUrl = videoUrlInput.value.trim();
                if (!videoUrl) {
                    showError('Please enter a YouTube video URL');
                    return;
                }
                
                // Parse video ID
                const videoId = getYouTubeVideoId(videoUrl);
                if (!videoId) {
                    showError('Invalid YouTube URL. Please enter a valid YouTube video link.');
                    return;
                }
                
                // Show loading state in button
                submitBtn.disabled = true;
                loadingSpinner.style.display = 'inline-block';
                
                // In a real application, you might validate the video exists
                // For this demo, we'll just show the preview and options
                setTimeout(() => {
                    submitBtn.disabled = false;
                    loadingSpinner.style.display = 'none';
                    showVideoPreview(videoId);
                }, 1000);
            });
            
            // Handle option selection
            optionCards.forEach(card => {
                card.addEventListener('click', function() {
                    const option = this.dataset.option;
                    
                    // Show loading state
                    optionsSection.classList.add('hidden');
                    loadingState.classList.remove('hidden');
                    loadingMessage.textContent = option === 'blog' 
                        ? 'Generating professional blog post...' 
                        : 'Creating interactive quiz questions...';
                    
                    // Get video URL
                    const videoUrl = videoUrlInput.value.trim();
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                    
                    // Make API request
                    fetch('/generate-blog-and-quiz/', {
                        method: 'POST',
                        body: new URLSearchParams({ 
                            'video_url': videoUrl,
                            'option': option 
                        }),
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'X-CSRFToken': csrfToken
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Server error');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Hide loading state
                        loadingState.classList.add('hidden');
                        
                        if (data.error) {
                            showError(data.error);
                            return;
                        }
                        
                        // For demo purposes, use the sample data if server returns empty data
                        let blogContent = data.blog_content;
                        let quizContent = data.quiz_content;
                        
                        // If server returns no data, use sample data
                        if (!blogContent && !quizContent) {
                            // Use sample data from your paste.txt
                            const sampleBlog = `# Unlocking the Power of Chunking in RAG Applications: From Basics to Advanced Optimization\n\nIn today's era of Artificial Intelligence, understanding how to manage and optimize data processing is crucial. One such intriguing concept is "chunking," specifically within Retrieval-Augmented Generation (RAG) applications. Dive into this comprehensive guide that reveals the intricacies of chunking strategies, offering insights from fundamental concepts to advanced implementations using Python.\n\n## The Basics of Chunking in RAG Systems\n\nChunking is the cornerstone of how RAG applications process and store data. In a typical setup, the text is divided into smaller, manageable chunks, which are converted into embeddings and then stored in a vector database. These chunks are later retrieved to provide context and generate accurate responses through language models.`;
                            
                            const sampleQuiz = `1. What is the first step in a basic RAG application as described in the video?\nA) Converting text to embeddings\nB) Dividing data into chunks\nC) Saving data in a vector database\nD) Asking a user question\nAnswer: B\n\n2. Why is chunking important in a RAG application?\nA) It helps to decrease data storage size\nB) It ensures high quality chunks produce high quality answers\nC) It improves the speed of data retrieval\nD) It prevents data loss\nAnswer: B`;
                            
                            blogContent = sampleBlog;
                            quizContent = sampleQuiz;
                        }
                        
                        // Render content
                        blogPost.innerHTML = renderMarkdown(blogContent);
                        quizQuestions.innerHTML = formatQuizQuestions(quizContent);
                        
                        // Show results and activate appropriate tab
                        resultsContainer.classList.remove('hidden');
                        
                        if (option === 'blog') {
                            activateTab('blog');
                        } else {
                            activateTab('quiz');
                        }
                        
                        // Scroll to results
                        resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showError('An error occurred while processing your request. Please try again later.');
                    });
                });
            });
            
            // Handle tab switching
            function activateTab(tabName) {
                // Update tab buttons
                tabBtns.forEach(btn => {
                    if (btn.id === `tab-${tabName}`) {
                        btn.classList.add('text-indigo-600', 'border-indigo-600');
                        btn.classList.remove('text-gray-500', 'border-transparent');
                    } else {
                        btn.classList.remove('text-indigo-600', 'border-indigo-600');
                        btn.classList.add('text-gray-500', 'border-transparent');
                    }
                });
                
                // Update tab content
                tabContents.forEach(content => {
                    if (content.id === `${tabName}-content`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            }
            
            // Add event listeners to tabs
            document.getElementById('tab-blog').addEventListener('click', () => activateTab('blog'));
            document.getElementById('tab-quiz').addEventListener('click', () => activateTab('quiz'));

            // Answer toggling event listener
            document.addEventListener("click", function(event) {
                if (event.target.classList.contains("toggle-answer")) {
                    const answerElement = event.target.nextElementSibling;
                    const isHidden = answerElement.classList.contains("hidden");
                    
                    // Toggle answer visibility
                    answerElement.classList.toggle("hidden");
                    
                    // Update button text
                    event.target.textContent = isHidden ? "Hide Answer" : "Show Answer";
                }
});
            // Copy buttons
            copyBlogBtn.addEventListener('click', function() {
                const textToCopy = blogPost.innerText;
                copyToClipboard(textToCopy);
                this.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                setTimeout(() => {
                    this.innerHTML = '<i class="far fa-copy mr-1"></i> Copy';
                }, 2000);
            });
            
            copyQuizBtn.addEventListener('click', function() {
                const textToCopy = quizQuestions.innerText;
                copyToClipboard(textToCopy);
                this.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                setTimeout(() => {
                    this.innerHTML = '<i class="far fa-copy mr-1"></i> Copy';
                }, 2000);
            });
        });
    </script>
</body>
</html>